<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LawBuddy - AI Legal Document Assistant</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>LawBuddy</h1>
            <p>Your AI-powered legal document assistant with voice support</p>
            <div id="user-status"></div>
        </div>
        <!-- Add after header, before main-grid -->
        <div class="language-selector-container">
            <div class="language-selector">
                <label for="language-select">üåê Language:</label>
                <select id="language-select" class="language-dropdown" onchange="changeLanguage()">
                    <option value="en">English</option>
                    <option value="hi">‡§π‡§ø‡§Ç‡§¶‡•Ä (Hindi)</option>
                    <option value="ta">‡Æ§‡ÆÆ‡Æø‡Æ¥‡Øç (Tamil)</option>
                    <option value="te">‡∞§‡±Ü‡∞≤‡±Å‡∞ó‡±Å (Telugu)</option>
                    <option value="bn">‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ (Bengali)</option>
                    <option value="mr">‡§Æ‡§∞‡§æ‡§†‡•Ä (Marathi)</option>
                    <option value="gu">‡™ó‡´Å‡™ú‡™∞‡™æ‡™§‡´Ä (Gujarati)</option>
                    <option value="kn">‡≤ï‡≤®‡≥ç‡≤®‡≤° (Kannada)</option>
                </select>
            </div>
            
            <!-- Updated user controls section -->
            <div class="user-controls" id="user-controls">
                <!-- This shows when user is logged in -->
                <div id="user-logged-in" style="display: none; align-items: center; gap: 10px;">
                    <span id="user-email-display" style="color: white; font-weight: 500;"></span>
                    <button class="admin-access-btn" onclick="logout()" style="background: rgba(239, 68, 68, 0.8);">
                        üö™ Logout
                    </button>
                </div>
                
                <!-- This shows when user is not logged in -->
                <div id="user-not-logged-in" style="display: flex; gap: 10px;">
                    <button class="admin-access-btn" onclick="showLoginModal()" style="background: rgba(16, 185, 129, 0.8);">
                        üë§ Login
                    </button>
                    <button class="admin-access-btn" onclick="showAdminLogin()" title="Admin Access">
                        üîß Admin
                    </button>
        </div>
            </div>
        </div>
        <!-- Main Content Grid -->
        <div class="main-grid">
            <!-- File Upload Section -->
            <div class="card">
                <h2 class="card-title">
                    <svg class="icon" viewBox="0 0 24 24">
                        <path d="M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20Z"/>
                    </svg>
                    Document Analysis
                </h2>
                <p>Upload your legal document for AI-powered analysis with voice support</p>
                
                <div class="file-upload" id="file-upload-area">
                    <input type="file" id="file-input" accept=".pdf,image/*,text/*" style="display: none;">
                    <svg width="48" height="48" viewBox="0 0 24 24" fill="#cbd5e0">
                        <path d="M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20Z"/>
                    </svg>
                    <p>Click to upload or drag & drop</p>
                    <small>PDF, Images, or Text files (Max 10MB)</small>
                </div>
                
                <!-- Progress Container -->
                <div class="progress-container" id="upload-progress" style="display: none;">
                    <div class="progress-header">
                        <div class="progress-title">Processing Document</div>
                        <div class="progress-percentage" id="progress-percent">0%</div>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="progress-fill"></div>
                    </div>
                    <div class="progress-steps" id="progress-steps">
                        <div class="progress-step" id="step-upload">
                            <div class="step-icon pending">1</div>
                            <span>Uploading file to storage</span>
                        </div>
                        <div class="progress-step" id="step-extract">
                            <div class="step-icon pending">2</div>
                            <span>Extracting document content</span>
                        </div>
                        <div class="progress-step" id="step-analyze">
                            <div class="step-icon pending">3</div>
                            <span>AI analysis in progress</span>
                        </div>
                        <div class="progress-step" id="step-complete">
                            <div class="step-icon pending">4</div>
                            <span>Generating insights and summary</span>
                        </div>
                    </div>
                </div>
                
                <button class="btn" id="analyze-file-btn" style="width: 100%; margin-top: 1rem;" disabled>
                    Analyze Document
                </button>
                
                <div class="loading-spinner" id="file-loading"></div>
            </div>

            <!-- Text Analysis Section -->
            <div class="card">
                <h2 class="card-title">
                    <svg class="icon" viewBox="0 0 24 24">
                        <path d="M3,3H21V5H3V3M3,7H15V9H3V7M3,11H21V13H3V11M3,15H15V17H3V15M3,19H21V21H3V19Z"/>
                    </svg>
                    Text Analysis
                </h2>
                <p>Paste text content for quick analysis with voice summary</p>
                
                <textarea class="textarea" id="text-input" placeholder="Paste your legal text, clause, or contract here..." maxlength="50000"></textarea>
                <div style="text-align: right; font-size: 0.8rem; color: #6b7280; margin-top: 0.5rem;">
                    <span id="char-count">0</span> / 50,000 characters
                </div>
                
                <button class="btn" id="analyze-text-btn" style="width: 100%; margin-top: 1rem;">
                    Analyze Text
                </button>
                
                <div class="loading-spinner" id="text-loading"></div>
            </div>
        </div>

        <!-- Chat Section -->
        <div class="card chat-section">
            <h2 class="card-title">
                <svg class="icon" viewBox="0 0 24 24">
                    <path d="M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2M12,6A2,2 0 0,1 14,8A2,2 0 0,1 12,10A2,2 0 0,1 10,8A2,2 0 0,1 12,6M12,20C10,20 8.4,19.2 7.5,18C8.5,17 10.1,16.5 12,16.5C13.9,16.5 15.5,17 16.5,18C15.6,19.2 14,20 12,20Z"/>
                </svg>
                Legal Assistant Chat
            </h2>
            <p>Ask questions about legal terms, clauses, or get general guidance with voice support</p>
            
            <div class="chat-window" id="chat-window">
                <div class="chat-message bot-message">
                    <p>üëã Hello! I'm LawBuddy, your AI legal assistant. I can help you:</p>
                    <ul style="margin-top: 0.5rem;">
                        <li>üìÑ Explain legal terms and clauses</li>
                        <li>‚öñÔ∏è Provide general legal guidance</li>
                        <li>üìã Summarize articles or documents</li>
                        <li>‚ö†Ô∏è Identify potential risks</li>
                        <li>üé§ Listen to your voice input and read responses aloud</li>
                    </ul>
                    <p style="margin-top: 0.5rem;"><strong>How can I help you today?</strong></p>
                </div>
            </div>
            
            <!-- SINGLE UNIFIED INPUT WITH VOICE -->
            <div class="input-group voice-enabled">
                <input type="text" class="form-input" id="chat-input" placeholder="Ask about legal terms, clauses, or analysis results..." maxlength="500">
                <button class="voice-input-btn" id="voice-input-btn" onclick="toggleVoiceInput()" title="Voice Input">
                    üé§
                </button>
                <button class="btn" id="send-chat-btn">Send</button>
            </div>

            <!-- Voice Input Status -->
            <div class="voice-status" id="voice-status" style="display: none;">
                <div class="voice-indicator">üé§ Listening...</div>
                <div class="voice-text" id="voice-text">Speak now...</div>
            </div>
        </div>

        <!-- Results Container -->
        <div class="results-container" id="results-container">
            <div class="card">
                <h2 class="card-title">
                    <svg class="icon" viewBox="0 0 24 24">
                        <path d="M9,3V4H4V6H5V19A2,2 0 0,0 7,21H17A2,2 0 0,0 19,19V6H20V4H15V3H9M7,6H17V19H7V6M9,8V17H11V8H9M13,8V17H15V8H13Z"/>
                    </svg>
                    Analysis Results
                </h2>
                
                <!-- Voice Player Section -->
                <div class="voice-player-container" id="voice-player" style="display: none;">
                    <div class="voice-controls">
                        <div style="display: flex; align-items: center; gap: 1rem;">
                            <button class="voice-button" id="play-btn" onclick="playAnalysis()">
                                <span>‚ñ∂Ô∏è</span> Play Analysis
                            </button>
                            <button class="voice-button" id="pause-btn" onclick="pauseAnalysis()" style="display: none;">
                                <span>‚è∏Ô∏è</span> Pause
                            </button>
                            <button class="voice-button" id="stop-btn" onclick="stopAnalysis()">
                                <span>‚èπÔ∏è</span> Stop
                            </button>
                        </div>
                        
                        <div class="voice-settings">
                            <span style="font-size: 0.9rem;">Language:</span>
                            <select class="voice-select" id="voice-language" onchange="changeVoiceLanguage()">
                                <option value="en-US">üá∫üá∏ English (US)</option>
                                <option value="en-GB">üá¨üáß English (UK)</option>
                                <option value="hi-IN">üáÆüá≥ Hindi</option>
                                <option value="es-ES">üá™üá∏ Spanish</option>
                                <option value="fr-FR">üá´üá∑ French</option>
                                <option value="de-DE">üá©üá™ German</option>
                                <option value="ja-JP">üáØüáµ Japanese</option>
                                <option value="zh-CN">üá®üá≥ Chinese</option>
                            </select>
                            
                            <span style="font-size: 0.9rem;">Speed:</span>
                            <input type="range" min="0.5" max="2" step="0.1" value="1" style="width: 80px;" onchange="changePlaybackSpeed(this.value)" id="speed-slider">
                            <span id="speed-display">1x</span>
                        </div>
                    </div>
                    
                    <div class="voice-progress">
                        <div class="voice-progress-bar" id="voice-progress-bar"></div>
                    </div>
                    
                    <div class="voice-info">
                        <span id="voice-current-section">Ready to play analysis</span>
                        <span id="voice-duration">0:00 / 0:00</span>
                    </div>
                    
                    <div class="voice-sections" id="voice-sections">
                        <button class="voice-section-btn" onclick="playSection('summary')">
                            üìã Summary <span style="opacity: 0.7;">(~2 min)</span>
                        </button>
                        <button class="voice-section-btn" onclick="playSection('risks')">
                            ‚ö†Ô∏è Risks <span style="opacity: 0.7;">(~1 min)</span>
                        </button>
                        <button class="voice-section-btn" onclick="playSection('timeline')">
                            üìÖ Timeline <span style="opacity: 0.7;">(~1 min)</span>
                        </button>
                        <button class="voice-section-btn" onclick="playSection('terms')">
                            üîë Key Terms <span style="opacity: 0.7;">(~2 min)</span>
                        </button>
                        <button class="voice-section-btn active" onclick="playSection('all')">
                            üéµ Full Analysis <span style="opacity: 0.7;">(~6 min)</span>
                        </button>
                    </div>
                </div>
                
                <!-- Tabs for different views -->
                <div class="tab-container">
                    <div class="tab active" data-tab="summary">üìã Summary</div>
                    <div class="tab" data-tab="risks">‚ö†Ô∏è Risks</div>
                    <div class="tab" data-tab="timeline">üìÖ Timeline</div>
                    <div class="tab" data-tab="terms">üîë Key Terms</div>
                    <div class="tab" data-tab="visual">üé® Visual</div>
                </div>

                <!-- Tab Contents -->
                <div id="tab-summary" class="tab-content">
                    <div class="results-grid">
                        <div class="result-card">
                            <h3>üìã Document Summary</h3>
                            <div id="summary-content"></div>
                        </div>
                        
                        <div class="result-card">
                            <h3>üìÑ Document Type</h3>
                            <div id="document-type-content"></div>
                        </div>
                        
                        <div class="result-card">
                            <h3>üí° Pro Tip</h3>
                            <div id="tip-content"></div>
                        </div>
                    </div>
                </div>

                <div id="tab-risks" class="tab-content" style="display: none;">
                    <div class="results-grid">
                        <div class="result-card">
                            <h3>‚ö†Ô∏è Identified Risks</h3>
                            <div id="risks-content"></div>
                        </div>
                        
                        <div class="result-card">
                            <h3>üö® Important Clauses</h3>
                            <div id="important-clauses-content"></div>
                        </div>
                    </div>
                </div>

                <div id="tab-timeline" class="tab-content" style="display: none;">
                    <div class="result-card">
                        <h3>üìÖ Important Dates & Timeline</h3>
                        <div id="timeline-content"></div>
                    </div>
                </div>

                <div id="tab-terms" class="tab-content" style="display: none;">
                    <div class="result-card">
                        <h3>üîë Key Terms Explained</h3>
                        <div id="key-terms-content"></div>
                    </div>
                </div>

                <div id="tab-visual" class="tab-content" style="display: none;">
                    <div class="result-card">
                        <h3>üé® Visual Representation</h3>
                        <div class="visual-container" id="visual-content"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Login Modal -->
    <div class="login-modal" id="login-modal">
        <div class="modal-content">
            <h2 style="margin-bottom: 1rem;">üîê Login Required</h2>
            <p style="margin-bottom: 1.5rem; color: #666;">Please enter your email to save and access your document analyses.</p>
            
            <div class="input-group" style="flex-direction: column;">
                <input type="email" class="form-input" id="email-input" placeholder="Enter your email address" style="margin-bottom: 1rem;">
            </div>
            
            <div style="display: flex; gap: 1rem; margin-top: 1rem;">
                <button class="btn" id="login-btn" style="flex: 1;">Login</button>
                <button class="btn btn-secondary" id="cancel-login-btn" style="flex: 1;">Cancel</button>
            </div>
        </div>
    </div>
    <div class="admin-modal" id="admin-modal">
        <div class="modal-content">
            <h2>üîß Admin Access</h2>
            <div class="admin-form">
                <div class="input-group">
                    <input type="text" id="admin-username" value="admin" class="form-input">
                </div>
                <div class="input-group password-group">
                    <input type="password" id="admin-password" value="123456" class="form-input">
                    <button type="button" class="password-toggle" onclick="togglePasswordVisibility()">üëÅÔ∏è</button>
                </div>
                <div class="modal-buttons">
                    <button class="btn" onclick="adminLogin()">Login</button>
                    <button class="btn btn-secondary" onclick="closeAdminModal()">Cancel</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Floating Voice Widget -->
    <button class="floating-voice-widget" id="floating-voice" onclick="toggleVoiceWidget()" title="Voice Assistant" style="display: none;">
        üé§
    </button>

    <!-- Notification -->
    <div class="notification" id="notification"></div>

    <script src="{{ url_for('static', filename='app.js') }}"></script>
</body>
</html>